<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Store - Choose Your Brand</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #ef4444; 
            --primary-hover: #dc2626;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: white;
            transition: background-color 0.3s ease;
            overflow-x: hidden;
            user-select: none;
        }

        .theme-bg { background-color: var(--primary-color) !important; }
        .theme-text { color: var(--primary-color) !important; }
        .theme-border { border-color: var(--primary-color) !important; }

        /* Styles for Brand Carousel */
        #brand-slider-container {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 450px;
            position: relative;
            width: 100vw;
            perspective: 1200px;
            cursor: grab;
        }
        #brand-slider-container:active { cursor: grabbing; }

        .brand-card {
            position: absolute;
            transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            width: 260px;
            height: 340px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 2.5rem;
            box-shadow: 0 10px 30px -5px rgba(0,0,0,0.08);
            pointer-events: auto;
            overflow: hidden;
            padding: 20px;
            border: 1px solid #f1f5f9;
        }

        .brand-logo-img {
            width: 120px;
            height: 120px;
            object-fit: contain;
            transition: transform 0.3s ease;
        }

        .brand-card.active {
            transform: translate3d(0, 0, 150px) scale(1.1);
            opacity: 1;
            filter: grayscale(0%);
            z-index: 30;
            box-shadow: 0 25px 60px -12px rgba(0,0,0,0.15);
            border: none;
        }

        .brand-card.prev {
            transform: translate3d(-115%, 0, 0) scale(0.8) rotateY(25deg);
            opacity: 0.4;
            filter: grayscale(100%);
            z-index: 20;
        }

        .brand-card.next {
            transform: translate3d(115%, 0, 0) scale(0.8) rotateY(-25deg);
            opacity: 0.4;
            filter: grayscale(100%);
            z-index: 20;
        }

        .brand-card.hidden-left { transform: translate3d(-250%, 0, -100px) scale(0.5); opacity: 0; z-index: 10; }
        .brand-card.hidden-right { transform: translate3d(250%, 0, -100px) scale(0.5); opacity: 0; z-index: 10; }

        .phone-img-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .phone-display-img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .modal-blur {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.85);
        }

        /* Improved Delivery Animations */
        @keyframes drawPath {
            0% { stroke-dashoffset: 1200; }
            100% { stroke-dashoffset: 0; }
        }
        
        .path-line {
            stroke-dasharray: 1200;
            stroke-dashoffset: 1200;
        }
        
        .animate-path {
            animation: drawPath 4s ease-in-out forwards;
        }

        .van-on-path {
            offset-path: path("M50 350 L200 350 L200 150 L500 150 L500 300 L750 300");
            offset-rotate: auto;
            animation: moveVan 4s ease-in-out forwards;
            position: absolute;
            z-index: 40;
        }

        @keyframes moveVan {
            0% { offset-distance: 0%; }
            100% { offset-distance: 100%; }
        }

        @keyframes pulseDestination {
            0% { transform: scale(1); opacity: 0.5; }
            100% { transform: scale(1.5); opacity: 0; }
        }

        .dest-pulse {
            animation: pulseDestination 1.5s infinite;
        }

        #settings-menu {
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #settings-menu.open { transform: translateX(0); }

        .btn-bounce:active { transform: scale(0.9); }

        .storage-btn {
            transition: all 0.3s ease;
        }
        .storage-btn.active {
            background-color: var(--primary-color) !important;
            color: white !important;
            border-color: var(--primary-color) !important;
        }
    </style>
</head>
<body>

    <header id="main-header" class="theme-bg text-white py-6 text-center fixed top-0 w-full z-50 shadow-md">
        <h1 id="header-title" class="text-xl font-black uppercase tracking-tighter">Choose Brand</h1>
    </header>

    <main class="mt-20">
        <!-- STEP 1: BRAND SELECTION -->
        <section id="brand-selection" class="min-h-screen flex flex-col justify-center items-center overflow-hidden bg-white">
            <div id="brand-slider-container"></div>
            <div class="flex items-center gap-12 mt-4">
                <button onclick="moveBrand(-1)" class="p-4 rounded-full bg-white border border-slate-100 shadow-sm hover:bg-slate-50 transition btn-bounce">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7" /></svg>
                </button>
                <div class="text-[10px] font-black text-slate-300 uppercase tracking-[0.2em] animate-pulse">Swipe or click brand</div>
                <button onclick="moveBrand(1)" class="p-4 rounded-full bg-white border border-slate-100 shadow-sm hover:bg-slate-50 transition btn-bounce">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7" /></svg>
                </button>
            </div>
        </section>

        <!-- STEP 2: PHONE CATALOG -->
        <section id="phone-catalog" class="hidden px-6 pt-10 pb-20">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-8 max-w-[1600px] mx-auto"></div>
        </section>

        <!-- STEP 3: SUCCESS SCREEN -->
        <section id="order-success" class="hidden flex flex-col items-center justify-center min-h-screen px-4 py-20">
            <div class="max-w-4xl w-full">
                <div class="text-center mb-10">
                    <h2 class="text-5xl md:text-6xl font-black theme-text uppercase italic tracking-tighter mb-4">On the Way!</h2>
                    <p class="text-slate-400 font-bold uppercase tracking-widest text-sm">We've received your order and the courier is moving</p>
                </div>
                
                <!-- Order Status Tabs -->
                <div class="flex justify-between mb-8 px-4">
                    <div class="flex flex-col items-center gap-2">
                        <div class="w-10 h-10 rounded-full theme-bg text-white flex items-center justify-center font-bold">‚úì</div>
                        <span class="text-[10px] font-black text-slate-400 uppercase">Processed</span>
                    </div>
                    <div class="flex-1 h-[2px] bg-slate-100 mt-5 mx-2">
                        <div class="h-full theme-bg w-full origin-left animate-[grow_1s_ease-out]"></div>
                    </div>
                    <div class="flex flex-col items-center gap-2">
                        <div class="w-10 h-10 rounded-full theme-bg text-white flex items-center justify-center font-bold animate-pulse">üöö</div>
                        <span class="text-[10px] font-black theme-text uppercase">Shipping</span>
                    </div>
                    <div class="flex-1 h-[2px] bg-slate-100 mt-5 mx-2"></div>
                    <div class="flex flex-col items-center gap-2">
                        <div class="w-10 h-10 rounded-full bg-slate-100 text-slate-300 flex items-center justify-center font-bold">üè†</div>
                        <span class="text-[10px] font-black text-slate-300 uppercase">Arrival</span>
                    </div>
                </div>

                <!-- Map Container -->
                <div class="w-full aspect-[16/9] md:aspect-[21/9] bg-white rounded-[3rem] relative overflow-hidden shadow-2xl border-4 theme-border">
                    <svg viewBox="0 0 800 450" class="w-full h-full bg-[#f8fafc]">
                        <!-- Decorative streets -->
                        <path d="M0 50 L800 50 M0 250 L800 250 M400 0 L400 450 M100 0 L100 450" stroke="#f1f5f9" stroke-width="40" fill="none" />
                        
                        <!-- Main Route Background -->
                        <path d="M50 350 L200 350 L200 150 L500 150 L500 300 L750 300" fill="none" stroke="#e2e8f0" stroke-width="34" stroke-linejoin="round" stroke-linecap="round" />
                        
                        <!-- Animated Route Path -->
                        <path id="delivery-path" class="path-line" d="M50 350 L200 350 L200 150 L500 150 L500 300 L750 300" fill="none" stroke="var(--primary-color)" stroke-width="14" stroke-linecap="round" stroke-linejoin="round" />
                        
                        <!-- Icons -->
                        <g transform="translate(35, 335)">
                            <rect width="40" height="40" rx="10" fill="white" shadow="0 2px 5px rgba(0,0,0,0.1)" />
                            <text x="8" y="28" font-size="24">üè™</text>
                        </g>
                        
                        <g transform="translate(735, 285)">
                            <circle cx="15" cy="15" r="25" fill="var(--primary-color)" class="dest-pulse" />
                            <circle cx="15" cy="15" r="10" fill="white" />
                            <text x="3" y="23" font-size="24">üè†</text>
                        </g>

                        <!-- Courier Label -->
                        <g id="courier-van" class="van-on-path">
                            <rect x="-30" y="-45" width="60" height="30" rx="8" fill="white" shadow="0 4px 10px rgba(0,0,0,0.2)" />
                            <text x="-22" y="-23" font-size="20">üöö</text>
                        </g>
                    </svg>
                </div>

                <div class="mt-12 flex flex-col md:flex-row items-center justify-between gap-6 bg-slate-50 p-8 rounded-[2rem]">
                    <div class="flex items-center gap-4">
                        <div class="w-14 h-14 rounded-full bg-white flex items-center justify-center text-2xl shadow-sm">üì¶</div>
                        <div>
                            <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Est. Delivery</p>
                            <p class="text-xl font-black text-slate-800 tracking-tighter">12 - 24 Hours</p>
                        </div>
                    </div>
                    <button onclick="resetApp()" class="px-10 py-4 theme-bg text-white rounded-2xl font-black text-sm uppercase tracking-widest hover:scale-105 active:scale-95 transition-all shadow-lg">Start New Order</button>
                </div>
            </div>
        </section>
    </main>

    <!-- MODAL -->
    <div id="order-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4">
        <div class="absolute inset-0 modal-blur" onclick="closeModal()"></div>
        <div class="bg-white w-full max-w-5xl rounded-[4rem] shadow-2xl relative z-10 overflow-hidden flex flex-col md:flex-row border-4 theme-border h-fit max-h-[95vh]">
            <div class="w-full md:w-1/2 p-12 flex flex-col items-center justify-center bg-white relative min-h-[400px] border-r border-slate-50">
                <div id="modal-image-container" class="phone-img-container transition-all duration-500 transform scale-110"></div>
                <h3 id="modal-phone-name" class="mt-12 text-3xl font-black text-center tracking-tighter uppercase italic"></h3>
            </div>
            <div class="w-full md:w-1/2 p-12 overflow-y-auto">
                <div class="mb-10">
                    <p class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-400 mb-6">01. Select Color</p>
                    <div id="modal-color-picker" class="flex flex-wrap gap-5"></div>
                </div>
                <div class="mb-10">
                    <p class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-400 mb-6">02. Capacity</p>
                    <div id="modal-storage-picker" class="grid grid-cols-2 gap-4"></div>
                </div>
                <div class="space-y-5 mb-12">
                    <p class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-400">03. Shipping Details</p>
                    <input id="user-name" type="text" placeholder="Full Name" class="w-full border-2 border-slate-100 rounded-2xl px-8 py-5 outline-none focus:theme-border transition-all shadow-sm bg-white">
                    <input id="user-address" type="text" placeholder="Street Address, City" class="w-full border-2 border-slate-100 rounded-2xl px-8 py-5 outline-none focus:theme-border transition-all shadow-sm bg-white">
                </div>
                <button onclick="placeOrder()" class="w-full theme-bg text-white py-6 rounded-[2.5rem] font-black text-2xl shadow-xl hover:-translate-y-1 active:scale-95 transition-all">CONFIRM ORDER</button>
            </div>
        </div>
    </div>

    <!-- SETTINGS MENU -->
    <div id="settings-menu" class="fixed right-0 top-0 h-full w-80 bg-white z-[110] shadow-[-20px_0_50px_rgba(0,0,0,0.05)] p-8 border-l-8 theme-border">
        <div class="flex justify-between items-center mb-12">
            <h3 class="text-2xl font-black uppercase italic theme-text tracking-tighter">Theme Editor</h3>
            <button onclick="toggleSettings()" class="text-4xl leading-none">&times;</button>
        </div>
        <p class="mb-6 font-bold text-slate-400 uppercase text-[10px] tracking-widest">Accent Color</p>
        <div class="grid grid-cols-4 gap-4 mb-12">
            <div onclick="changeTheme('#ef4444')" class="w-12 h-12 rounded-2xl bg-red-500 cursor-pointer shadow-sm hover:scale-110 transition-all"></div>
            <div onclick="changeTheme('#3b82f6')" class="w-12 h-12 rounded-2xl bg-blue-500 cursor-pointer shadow-sm hover:scale-110 transition-all"></div>
            <div onclick="changeTheme('#10b981')" class="w-12 h-12 rounded-2xl bg-emerald-500 cursor-pointer shadow-sm hover:scale-110 transition-all"></div>
            <div onclick="changeTheme('#000000')" class="w-12 h-12 rounded-2xl bg-black cursor-pointer shadow-sm hover:scale-110 transition-all"></div>
            <div onclick="changeTheme('#ec4899')" class="w-12 h-12 rounded-2xl bg-pink-500 cursor-pointer shadow-sm hover:scale-110 transition-all"></div>
            <div onclick="changeTheme('#8b5cf6')" class="w-12 h-12 rounded-2xl bg-violet-500 cursor-pointer shadow-sm hover:scale-110 transition-all"></div>
            <div onclick="changeTheme('#64748b')" class="w-12 h-12 rounded-2xl bg-slate-500 cursor-pointer shadow-sm hover:scale-110 transition-all"></div>
            <div onclick="changeTheme('#06b6d4')" class="w-12 h-12 rounded-2xl bg-cyan-500 cursor-pointer shadow-sm hover:scale-110 transition-all"></div>
        </div>
    </div>

    <!-- FAB Settings -->
    <button onclick="toggleSettings()" class="fixed bottom-6 right-6 z-[105] w-16 h-16 theme-bg text-white rounded-full flex items-center justify-center shadow-2xl hover:rotate-90 transition-all duration-500">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" /></svg>
    </button>

    <script>
        const brands = [
            { id: 'apple', name: 'Apple', logo: 'Ô£ø', img: 'https://upload.wikimedia.org/wikipedia/commons/f/fa/Apple_logo_black.svg' },
            { id: 'samsung', name: 'Samsung', logo: 'S', img: 'https://static.vecteezy.com/system/resources/previews/020/975/547/non_2x/samsung-logo-samsung-icon-transparent-free-png.png' },
            { id: 'google', name: 'Google', logo: 'G', img: 'https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg' },
            { id: 'xiaomi', name: 'Xiaomi', logo: 'Mi', img: 'https://upload.wikimedia.org/wikipedia/commons/a/ae/Xiaomi_logo_%282021-%29.svg' },
            { id: 'poco', name: 'Poco', logo: 'P', img: 'https://1000logos.net/wp-content/uploads/2022/12/POCO-Emblem.png' }
        ];

        const phones = [
            { 
                id: 1, 
                name: 'iPhone 17 Pro Max', 
                storage: ['256 GB', '512 GB', '1 TB'],
                variants: [
                    { color: '#f97316', img: 'https://content2.rozetka.com.ua/goods/images/big/594364394.jpg' }, 
                    { color: '#334155', img: 'https://content2.rozetka.com.ua/goods/images/big/594372256.jpg' },
                    { color: '#e2e8f0', img: 'https://content2.rozetka.com.ua/goods/images/big/594352221.jpg' }
                ]
            },
            { 
                id: 2, 
                name: 'iPhone 17 Pro', 
                storage: ['128 GB', '256 GB', '512 GB', '1 TB'],
                variants: [
                    { color: '#f97316', img: 'https://content2.rozetka.com.ua/goods/images/big/594364394.jpg' }, 
                    { color: '#334155', img: 'https://content2.rozetka.com.ua/goods/images/big/594372256.jpg' },
                    { color: '#e2e8f0', img: 'https://content2.rozetka.com.ua/goods/images/big/594352221.jpg' }
                ]
            },
            { 
                id: 3, 
                name: 'iPhone 17', 
                storage: ['128 GB', '256 GB', '512 GB'],
                variants: [
                    { color: '#1c1c1c', name: 'Black', img: 'https://content1.rozetka.com.ua/goods/images/big/594345313.jpg' }, 
                    { color: '#d8d2e1', name: 'Lavender', img: 'https://content1.rozetka.com.ua/goods/images/big/594345455.jpg' }, 
                    { color: '#b6c5d1', name: 'Mist Blue', img: 'https://content.rozetka.com.ua/goods/images/big/594345406.jpg' },
                    { color: '#f9f9f9', name: 'White', img: 'https://content2.rozetka.com.ua/goods/images/big/594345480.jpg' }
                ]
            },
            { 
                id: 4, 
                name: 'iPhone 16 Pro Max', 
                storage: ['256 GB', '512 GB', '1 TB'],
                variants: [
                    { color: '#baafa1', name: 'Desert Titanium', img: 'https://content.rozetka.com.ua/goods/images/big/635464828.jpg' },
                    { color: '#b0aea9', name: 'Natural Titanium', img: 'https://content1.rozetka.com.ua/goods/images/big/642289153.jpg' },
                    { color: '#f2f1ed', name: 'White Titanium', img: 'https://content.rozetka.com.ua/goods/images/big/634392130.jpg' },
                    { color: '#3c3c3d', name: 'Black Titanium', img: 'https://content.rozetka.com.ua/goods/images/big/635448221.jpg' }
                ]
            },
            { id: 5, name: 'iPhone 16 Pro', storage: ['128 GB', '256 GB', '512 GB', '1 TB'], variants: [ { color: '#baafa1', name: 'Desert Titanium', img: 'https://content.rozetka.com.ua/goods/images/big/635464828.jpg' }, { color: '#b0aea9', name: 'Natural Titanium', img: 'https://content1.rozetka.com.ua/goods/images/big/642289153.jpg' }, { color: '#f2f1ed', name: 'White Titanium', img: 'https://content.rozetka.com.ua/goods/images/big/634392130.jpg' }, { color: '#3c3c3d', name: 'Black Titanium', img: 'https://content.rozetka.com.ua/goods/images/big/635448221.jpg' } ] },
            { id: 6, name: 'iPhone 16', storage: ['128 GB', '256 GB', '512 GB'], variants: [ { color: '#566993', name: 'Ultramarine', img: 'https://content2.rozetka.com.ua/goods/images/big/468888032.jpg' }, { color: '#77908b', name: 'Teal', img: 'https://content2.rozetka.com.ua/goods/images/big/468886706.jpg' }, { color: '#e4b5b7', name: 'Pink', img: 'https://content1.rozetka.com.ua/goods/images/big/468887116.jpg' }, { color: '#f2f1ed', name: 'White', img: 'https://content1.rozetka.com.ua/goods/images/big/468886645.jpg' }, { color: '#3c3c3d', name: 'Black', img: 'https://content1.rozetka.com.ua/goods/images/big/468886429.jpg' } ] },
            { id: 7, name: 'iPhone 15 Pro Max', storage: ['256 GB', '512 GB', '1 TB'], variants: [ { color: '#b0aea9', name: 'Natural Titanium', img: 'https://content1.rozetka.com.ua/goods/images/big/518271495.jpg' }, { color: '#4a5461', name: 'Blue Titanium', img: 'https://content.rozetka.com.ua/goods/images/big/518271479.jpg' }, { color: '#f2f1ed', name: 'White Titanium', img: 'https://content.rozetka.com.ua/goods/images/big/518271507.jpg' }, { color: '#3c3c3d', name: 'Black Titanium', img: 'https://content2.rozetka.com.ua/goods/images/big/518271461.jpg' } ] },
            { id: 8, name: 'iPhone 15 Pro', storage: ['128 GB', '256 GB', '512 GB', '1 TB'], variants: [ { color: '#b0aea9', name: 'Natural Titanium', img: 'https://content1.rozetka.com.ua/goods/images/big/518271495.jpg' }, { color: '#4a5461', name: 'Blue Titanium', img: 'https://content.rozetka.com.ua/goods/images/big/518271479.jpg' }, { color: '#f2f1ed', name: 'White Titanium', img: 'https://content.rozetka.com.ua/goods/images/big/518271507.jpg' }, { color: '#3c3c3d', name: 'Black Titanium', img: 'https://content2.rozetka.com.ua/goods/images/big/518271461.jpg' } ] },
            { id: 9, name: 'iPhone 15', storage: ['128 GB', '256 GB', '512 GB'], variants: [ { color: '#eecad1', name: 'Pink', img: 'https://content2.rozetka.com.ua/goods/images/big/364623524.jpg' }, { color: '#cadfc1', name: 'Green', img: 'https://content.rozetka.com.ua/goods/images/big/364623606.jpg' }, { color: '#d2e0e7', name: 'Blue', img: 'https://content.rozetka.com.ua/goods/images/big/364623610.jpg' }, { color: '#3c3c3d', name: 'Black', img: 'https://content1.rozetka.com.ua/goods/images/big/364623614.jpg' } ] },
            { id: 10, name: 'iPhone 15 Plus', storage: ['128 GB', '256 GB', '512 GB'], variants: [ { color: '#eecad1', name: 'Pink', img: 'https://content2.rozetka.com.ua/goods/images/big/364623524.jpg' }, { color: '#cadfc1', name: 'Green', img: 'https://content.rozetka.com.ua/goods/images/big/364623606.jpg' }, { color: '#d2e0e7', name: 'Blue', img: 'https://content.rozetka.com.ua/goods/images/big/364623610.jpg' }, { color: '#3c3c3d', name: 'Black', img: 'https://content1.rozetka.com.ua/goods/images/big/364623614.jpg' } ] }
        ];

        let currentIdx = 0;
        let startX = 0;
        let isDragging = false;
        let selectedStorageValue = "";

        window.onload = () => { renderBrands(); setupInputEvents(); };

        function renderBrands() {
            const container = document.getElementById('brand-slider-container');
            container.innerHTML = brands.map((b, i) => `
                <div class="brand-card" id="brand-${i}" onclick="handleBrandClick(${i})">
                    ${b.img ? `<img src="${b.img}" class="brand-logo-img" alt="${b.name}">` : `<span class="text-8xl font-black mb-4">${b.logo}</span>`}
                    <span class="text-2xl font-black uppercase tracking-widest mt-6 text-slate-800">${b.name}</span>
                </div>
            `).join('');
            updateSlider();
        }

        function handleBrandClick(i) {
            if (isDragging) return;
            if (i === currentIdx) selectBrand();
            else { currentIdx = i; updateSlider(); }
        }

        function updateSlider() {
            brands.forEach((_, i) => {
                const card = document.getElementById(`brand-${i}`);
                card.className = 'brand-card';
                if (i === currentIdx) card.classList.add('active');
                else if (i === (currentIdx - 1 + brands.length) % brands.length) card.classList.add('prev');
                else if (i === (currentIdx + 1) % brands.length) card.classList.add('next');
                else if (i < currentIdx) card.classList.add('hidden-left');
                else card.classList.add('hidden-right');
            });
        }

        function moveBrand(dir) { currentIdx = (currentIdx + dir + brands.length) % brands.length; updateSlider(); }

        function setupInputEvents() {
            const slider = document.getElementById('brand-slider-container');
            const handleStart = (x) => { startX = x; isDragging = false; };
            const handleEnd = (x) => {
                const diff = startX - x;
                if (Math.abs(diff) > 50) { isDragging = true; moveBrand(diff > 0 ? 1 : -1); }
            };
            slider.addEventListener('touchstart', (e) => handleStart(e.touches[0].clientX), {passive: true});
            slider.addEventListener('touchend', (e) => handleEnd(e.changedTouches[0].clientX), {passive: true});
            slider.addEventListener('mousedown', (e) => handleStart(e.clientX));
            window.addEventListener('mouseup', (e) => {
                if (startX !== 0) { handleEnd(e.clientX); startX = 0; setTimeout(() => isDragging = false, 50); }
            });
        }

        function selectBrand() {
            document.getElementById('brand-selection').classList.add('hidden');
            document.getElementById('phone-catalog').classList.remove('hidden');
            document.getElementById('header-title').innerText = "Pick Your iPhone";
            renderPhones();
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function renderPhones() {
            const grid = document.querySelector('#phone-catalog > div');
            grid.innerHTML = phones.map(p => `
                <div onclick="openModal(${p.id})" class="bg-white rounded-[3.5rem] p-10 shadow-sm hover:shadow-2xl transition-all duration-500 cursor-pointer group border border-slate-50 hover:theme-border">
                    <div class="aspect-[3/4] flex items-center justify-center mb-8 bg-white rounded-[3rem] p-6 border border-slate-50">
                        ${getPhonePreview(p)}
                    </div>
                    <h4 class="text-2xl font-black text-center text-slate-800 group-hover:theme-text transition-colors tracking-tighter italic uppercase">${p.name}</h4>
                    <div class="flex justify-center gap-2 mt-6">
                        ${p.variants.map(v => `<div class="w-4 h-4 rounded-full shadow-inner border border-slate-200" style="background-color: ${v.color}" title="${v.name || ''}"></div>`).join('')}
                    </div>
                </div>
            `).join('');
        }

        function getPhonePreview(phone) {
            const variant = phone.variants[0];
            if (variant.img) return `<img src="${variant.img}" class="phone-display-img" alt="${phone.name}">`;
            return createPhoneSvg(variant.color, 120);
        }

        function createPhoneSvg(color, h = 150) {
            const w = h * 0.5;
            return `
                <svg width="${w}" height="${h}" viewBox="0 0 100 200" class="phone-display-img">
                    <rect x="5" y="5" width="90" height="190" rx="14" fill="${color}" />
                    <rect x="12" y="12" width="76" height="176" rx="10" fill="rgba(0,0,0,0.05)" />
                    <rect x="35" y="10" width="30" height="6" rx="3" fill="#111" />
                    <rect x="30" y="30" width="40" height="40" rx="20" fill="white" opacity="0.1" />
                </svg>`;
        }

        function openModal(id) {
            const p = phones.find(x => x.id === id);
            document.getElementById('modal-phone-name').innerText = p.name;
            updateModalMedia(p.variants[0]);
            document.getElementById('modal-color-picker').innerHTML = p.variants.map(v => `
                <div onclick="updateModalMedia({color: '${v.color}', img: '${v.img}'}, event)" 
                     class="w-12 h-12 rounded-full cursor-pointer border-4 border-transparent hover:scale-110 transition-all shadow-md active:scale-90" 
                     style="background-color: ${v.color}" title="${v.name || ''}"></div>`).join('');
            document.getElementById('modal-storage-picker').innerHTML = p.storage.map((size, idx) => `
                <button onclick="handleStorageSelection('${size}', event)" 
                        class="storage-btn border-2 ${idx === 0 ? 'theme-border theme-text active' : 'border-slate-100 text-slate-400'} rounded-2xl py-4 font-bold bg-white hover:border-slate-200">${size}</button>`).join('');
            selectedStorageValue = p.storage[0];
            document.getElementById('order-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function handleStorageSelection(size, event) {
            selectedStorageValue = size;
            document.querySelectorAll('.storage-btn').forEach(btn => {
                btn.classList.remove('active', 'theme-border', 'theme-text');
                btn.classList.add('border-slate-100', 'text-slate-400');
            });
            event.target.classList.add('active', 'theme-border', 'theme-text');
            event.target.classList.remove('border-slate-100', 'text-slate-400');
        }

        function updateModalMedia(variant, event) {
            const container = document.getElementById('modal-image-container');
            container.style.opacity = '0';
            container.style.transform = 'scale(1.05)';
            setTimeout(() => {
                if (variant.img) container.innerHTML = `<img src="${variant.img}" class="phone-display-img" alt="Selected">`;
                else container.innerHTML = createPhoneSvg(variant.color, 280);
                container.style.opacity = '1';
                container.style.transform = 'scale(1.1)';
            }, 300);
            if (event) {
                document.querySelectorAll('#modal-color-picker div').forEach(d => d.style.borderColor = 'transparent');
                event.target.style.borderColor = 'rgba(0,0,0,0.1)';
            }
        }

        function closeModal() { document.getElementById('order-modal').classList.add('hidden'); document.body.style.overflow = 'auto'; }

        function placeOrder() {
            if(!document.getElementById('user-name').value || !document.getElementById('user-address').value) return alert('Enter details');
            closeModal();
            document.getElementById('phone-catalog').classList.add('hidden');
            document.getElementById('main-header').classList.add('hidden');
            document.getElementById('order-success').classList.remove('hidden');
            
            // Start Path Animation
            const path = document.getElementById('delivery-path');
            path.classList.add('animate-path');
            
            // Start Van Animation on Path
            const van = document.getElementById('courier-van');
            van.style.animation = 'none';
            void van.offsetWidth; // trigger reflow
            van.style.animation = null;
            van.classList.add('van-on-path');
        }

        function resetApp() { location.reload(); }
        function toggleSettings() { document.getElementById('settings-menu').classList.toggle('open'); }
        function changeTheme(c) {
            document.documentElement.style.setProperty('--primary-color', c);
            renderPhones();
        }
    </script>
</body>
</html>
